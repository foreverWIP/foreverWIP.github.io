<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Sonic 1 Mega CD Port | Amy Farbright</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico">
</head>

<body>
  <div class="page-container">
    <div class="top-menu">
      <div class="menu-button">
        <a href="#sidebar"><h1 class="sidebar-icon">☰</h1></a>
      </div>
      <h1 class="header-name">Amy Farbright<img class="logo" src="/assets/img/tiney_amelia.png" /></h1>
    </div>
    <div class="page-sidebar" id="sidebar">
      <img class="logo" src="/assets/img/tiney_amelia.png" />
      <nav>
	<div class="nav-border-container">
		<div class="nav-pages">
			<p class="nav-item"><a href="/index.html">About Me</a></p>
			
			<p class="nav-item"><a class="project" href="/projects/irlwork.html">IRL work</a></p>
			
			<p class="nav-item"><a class="project" href="/projects/retroengine.html">Retro Engine Hacking</a></p>
			
			<p class="nav-item"><a class="project" href="/projects/s1mcd.html">Sonic 1 Mega CD Port</a></p>
			
			<p class="nav-item"><a class="project" href="/projects/s1port.html">Sonic 1 C Port</a></p>
			
			<p class="nav-item"><a class="project" href="/projects/s2hd.html">Sonic 2 HD</a></p>
			
			<p class="nav-item"><a class="project" href="/projects/neid.html">NEID</a></p>
			
			<p class="nav-item"><a class="project" href="/projects/prototypen.html">Prototype N</a></p>
			
		</div>
		<div class="socials-credits">
			<div class="nav-socials">
				<div class="social-link link-email">
					<a href="mailto:amywrightmail@protonmail.com">✉</a>
				</div>
				<div class="social-link link-github">
					<a href="https://github.com/foreverWIP"><img
							src="https://github.githubassets.com/favicons/favicon-dark.svg" /></a>
				</div>
				<div class="social-link link-bluesky">
					<a href="https://bsky.app/profile/amy.fruitbasket.gay"><img
							src="https://bsky.social/about/images/favicon-32x32.png" /></a>
				</div>
				<div class="social-link link-tumblr">
					<a href="https://www.tumblr.com/blog/amyfarbright"><img src="/assets/img/tumblricon.png" /></a>
				</div>
			</div>
			<p class="credits">
				Page design by Amy Farbright. Portrait and mascot by <a
					href="https://twitter.com/cathodegaytube">cathodegaytube</a>. Site generated by <a
					href="https://cobalt-org.github.io/">Cobalt</a>.
			</p>
		</div>
	</div>
</nav>
    </div>
    <div class="page-content">
      <h1>Sonic 1 Mega CD Port</h1>
      <p>Source <a href="https://github.com/foreverWIP/s1disasm/tree/MMD">here</a>.
Download <a href="https://github.com/foreverWIP/s1disasm/releases">here</a>!</p>
<p><img src="../assets/img/shc1.png" alt="" /></p>
<p>For the 2024 <a href="https://shc.zone">Sonic Hacking Contest</a>, I made a port of Sonic 1 for Mega Drive to the Sega Mega CD, an often-overlooked hardware addon for the console. I worked on it over the course of about two months, as a way for me to learn new hardware and to give an example for others to work off of for developing their own games for it. There are a few notable things about this project:</p>
<ul>
<li>This runs in Mega CD Mode 2, which means there's no ROM cartridge involved. All data is read and loaded from a CD.</li>
<li>There is a minimal &quot;sound driver&quot; running on the Mega CD that cooperates with the Mega Drive to play sequenced drum samples</li>
<li>This project is open source, unlike most previous projects bringing Sonic gameplay to Mega CD.</li>
</ul>
<p>Due to the new storage format, many changes had to be made to fit everything. With no ROM area to work with, you lose the 512kb of space the game would otherwise fit into (and the other 3.5mb of space you could use to store new data statically). Instead, you have to divvy up your data between:</p>
<ul>
<li>&quot;Work RAM&quot; (64kb), the RAM area of the Mega Drive</li>
<li>&quot;PRG RAM&quot; (512kb), the working memory area of the Mega CD specifically</li>
<li>&quot;Word RAM&quot; (256kb), a memory area offered by the Mega CD that can be shared between it and the Mega Drive with a memory-mapped register</li>
</ul>
<p><img src="../assets/img/shc3.png" alt="" /></p>
<p>PRG RAM is an attractive option for moving things into, but the Mega CD can't easily access the Mega Drive's video hardware (the VDP chip). Mega CD's processor is a Motorola 68000 (same as Mega Drive's) running at a higher clock speed, so game code could absolutely be run on it, but you quickly run into design problems of how to coordinate interaction with the VDP. Given the deadline I had, I decided the better option would be to mimic the way Sonic CD (a classic Sonic game originally developed for Mega CD) handles its normal levels.</p>
<p>I set up a system where a set of &quot;kernel&quot; programs, running on the Mega Drive and Mega CD simultaneously, cooperate to load in levels to Word RAM as nearly-standalone code modules that the Mega Drive then executes. Fitting each level into Word RAM required trimming a lot of unnecessary data from Sonic 1's assembly code, and making heavy use of assembler directives to selectively include relevant parts of code and data, sometimes aligned to expected memory addresses.</p>
<p><img src="../assets/img/shc2.png" alt="" /></p>
<p>This port also features notable sound modifications. The biggest draw of using a CD as a medium of storage is the possibility of streaming high-quality audio. While I was not able to set that up in the time I had, I did manage to set up playback of drum samples on the Mega CD, replacing the Mega Drive's PCM playback. I converted the raw waveform data from the format used by the original game's sound engine, to a format directly usable by the Mega CD's onboard audio chip. Then, in the kernel, I recieve signals from the Mega Drive to play certain samples where appropriate. I hope to expand on this further in future releases.</p>
<p><img src="../assets/img/shc4.png" alt="" /></p>
<p>I'm excited for what this project can do for the future of homebrew on the Mega CD. It's not a terribly well-documented piece of hardware, but its potential definitely opens up a lot of possibilities for how to expand existing Mega Drive games.</p>

    </div>
  </div>
  <script src="/assets/js/mobile-navbar.js"></script>
</body>

</html>