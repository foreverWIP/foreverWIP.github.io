<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>NEID | Amy Farbright</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico">
</head>

<body>
  <div class="page-container">
    <div class="top-menu">
      <div class="menu-button">
        <a href="#sidebar"><h1 class="sidebar-icon">☰</h1></a>
      </div>
      <h1 class="header-name">Amy Farbright<img class="logo" src="/assets/img/tiney_amelia.png" /></h1>
    </div>
    <div class="page-sidebar" id="sidebar">
      <img class="logo" src="/assets/img/tiney_amelia.png" />
      <nav>
    <div class="nav-border-container">
        <div class="nav-pages">
            <p class="nav-item"><a href="/index.html">About Me</a></p>
            
            <p class="nav-item"><a class="project" href="/projects/irlwork.html">IRL work</a></p>
            
            <p class="nav-item"><a class="project" href="/projects/retroengine.html">Retro Engine Hacking</a></p>
            
            <p class="nav-item"><a class="project" href="/projects/s2hd.html">Sonic 2 HD</a></p>
            
            <p class="nav-item"><a class="project" href="/projects/neid.html">NEID</a></p>
            
            <p class="nav-item"><a class="project" href="/projects/prototypen.html">Prototype N</a></p>
            
        </div>
        <div class="socials-credits">
            <div class="nav-socials">
                <div class="social-link link-cohost">
                    <a href="https://cohost.org/amy"><img
                            src="https://cohost.org/static/7ec6f0f3aef87d734f9b.png" /></a>
                </div>
                <div class="social-link link-github">
                    <a href="https://github.com/foreverWIP"><img src="/assets/img/github-mark-white.svg" /></a>
                </div>
                <div class="social-link link-email">
                    <a href="mailto:amywrightmail@protonmail.com">✉</a>
                </div>
            </div>
            <p class="credits">
                Page design by <a href="https://github.com/foreverWIP">Amy Farbright</a>. Portrait and mascot by <a
                    href="https://twitter.com/cathodegaytube">cathodegaytube</a>. Site generated by <a
                    href="https://cobalt-org.github.io/">Cobalt</a>.
            </p>
        </div>
    </div>
</nav>
    </div>
    <div class="page-content">
      <h1>NEID</h1>
      <p>In December 2021, a <a href="https://twitter.com/KetDarkDragon/status/1467162210036244480">tweet</a> about reverse engineering the Sega Saturn game &quot;NiGHTS into Dreams...&quot; caught my eye. Within the game's community there had been constant discussion of a cut boss named Self (Selph in the game files), with few clues pointing to what the character actually looked like. In my search for this proverbial white whale, I ended up writing an interesting utility for the game that hadn't existed previously.</p>
<div class="two-side-by-side">
<div style="flex-grow:1;" ></div>
<img src="../assets/img/ENDING2_0003CFBC.png" alt="Clean monochrome previews of raw graphics found in Nights into Dreams." title="The lack of color is due to the color data being stored in a region of the game that hasn't been discovered yet. These will be updated once those are found!">
<img src="../assets/img/ENDING2_00048714.png" alt="Clean monochrome previews of raw graphics found in Nights into Dreams." title="The lack of color is due to the color data being stored in a region of the game that hasn't been discovered yet. These will be updated once those are found!">
<div style="flex-grow:1;" ></div>
</div>
<p>It was widely believed that graphics for Self existed in the ending and credits data of the game, however the graphics data was in a format that at that point had not been figured out in any capacity. There wasn't too much work put into dissecting the code of the game in general, but the Sega Saturn's hardware and memory setup had already been fairly well documented, so I decided to try my hand at disassembly. With the help of the Ghidra reverse-engineering suite, as well as the debugger integrated into my Saturn emulator, I was able to narrow down the exact program and memory addresses where the graphics data was loaded and processed. The nature of the code I discovered proved to be tricky...</p>
<p><img src="../assets/img/ghidraview.png" alt="A screenshot of the game's disassembled machine code in Ghidra." title="Ghidra's tools provide extremely powerful code analysis, but even they aren't perfect." /></p>
<p>Ghidra comes equipped with a decompiler that attempts to take a given set of assembly instructions, and transform it into more readable C code. Unfortunately, due to how the code was structured (which was tripping up the decompiler), as well as the Saturn itself working in big-endian (when all modern desktop computers work in little-endian), I couldn't easily work the C code to my advantage. In order to get this code working outside its original context, I ended up taking a very unorthodox and very silly approach...</p>
<p><img src="../assets/img/neidsource.png" alt="A view of the source code for the tool I created to view the ending data." title="As some would say, 'Welcome to my twisted mind.'" /></p>
<p>I hand-translated every single SuperH 2 instruction in the graphics processing function to working code in C#. I wrote a wrapper around every memory I/O operation such that Saturn-based addresses mapped to appropriate allocated buffers for the program, and all reads and writes were automatically endian-swapped. I cross-checked, double checked, triple checked, with an instruction set reference to ensure every single translated instruction did the exact same intended operations specified. Eventually, miraculously, I ended up with perfectly-working &quot;pre-emulated&quot; code that read in compressed graphics data, and decompressed it directly into an output buffer.</p>
<p><img src="../assets/img/neiddataraw.png" alt="A view of the decompressed graphics data, inside a binary data visualizer." title="The decompressed data as used by the Saturn still isn't easily viewable, so the tool generates an image file as well." /></p>
<p>Did I find Self? Unfortunately, none of the extracted data gave any clues. But in the process of looking I learned SH2 assembly, cracked a compression format, and got ahold of raw data that had not been seen in a viewable form since probably 1996. The end result is NiGHTS Ending Image Decompressor (NEID), whose source code you can find <a href="https://github.com/foreverWIP/NEID">here</a>.</p>

    </div>
  </div>
  <script src="/assets/js/mobile-navbar.js"></script>
</body>

</html>